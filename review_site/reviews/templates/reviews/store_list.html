{% extends 'reviews/base.html' %}

{% block content %}
    <h1>お店一覧</h1>

    <div class="search-form">
        <form method="get" action="{% url 'store_list' %}">
            <input type="text" name="q" class="search-input" placeholder="店名や住所で検索..." value="{{ query|default_if_none:'' }}">
            <button type="submit" class="search-button">検索</button>
        </form>
    </div>
    <hr>

    {# --- あなたのデータベースの検索結果 --- #}
    {% for store in stores %}
        <div class="store-card" style="display: flex; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
            
            {% if store.image_data %}
                <img src="{{ store.get_image_url }}" alt="{{ store.name }}の画像" style="width: 150px; height: 150px; object-fit: cover; border-radius: 8px; margin-right: 20px;">
            {% else %}
                <div style="width: 150px; height: 150px; background-color: #e8e8e8; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #aaa; margin-right: 20px;">
                    <span>画像なし</span>
                </div>
            {% endif %}
            
            <div>
                <h2><a href="{% url 'store_detail' store.id %}">{{ store.name }}</a></h2>
                <p>住所: {{ store.address }}</p>
                <p>登録者: {{ store.created_by.username }}</p>
            </div>

        </div>
    {% endfor %}

    {# --- ここからホットペッパーAPIの検索結果を追加 --- #}
    {% if api_stores %}
        <h2 style="margin-top: 40px;">ホットペッパーの検索結果</h2>
        {% for store in api_stores %}
            <div class="store-card" style="display: flex; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                
                <img src="{{ store.photo.pc.m }}" alt="{{ store.name }}" style="width: 150px; height: 150px; object-fit: cover; border-radius: 8px; margin-right: 20px;">
                
                <div>
                    <h2>{{ store.name }} ({{ store.station_name }})</h2>
                    <p>住所: {{ store.address }}</p>
                    <p>ジャンル: {{ store.genre.name }}</p>
                </div>
            </div>
        {% endfor %}
    {% endif %}
    {# --- ここまでAPIの検索結果 --- #}


    {# --- 検索結果が0件だった場合の表示 --- #}
    {% if not stores and not api_stores %}
        {% if query %}
            <p style="text-align: center;">「{{ query }}」に一致するお店は見つかりませんでした。</p>
        {% else %}
            <p style="text-align: center;">まだ登録されているお店がありません。</p>
        {% endif %}
    {% endif %}

{% endblock %}
